<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CostFur - Tính giá Nội thất Nhanh</title>
    <link rel="icon" href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' fill='%233730a3'%3e%3cpath d='M507.41 19.82c-4.49-4.49-10.49-6.83-16.5-6.83-6.02 0-12.01 2.34-16.51 6.83L347.53 146.69l-18.7-18.7c-4.28-4.28-11.27-4.59-15.93-.72L21.5 258.4c-4.45 3.69-5.59 10.15-2.73 14.9l121.36 205.82c2.86 4.75 9.17 6.27 14.62 3.44l131.14-68.52c4.66-2.44 7.23-7.88 6.42-13.43l-18.39-125.61 18.7 18.7c4.49 4.49 10.49 6.83 16.5 6.83 6.02 0 12.01 2.34 16.51-6.83L507.41 52.83c9.02-9.02 9.02-23.56 0-33.01zM288 288c-17.67 0-32 14.33-32 32s14.33 32 32 32 32-14.33 32-32-14.33-32-32-32z'/%3e%3c/svg%3e">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Initial Loading Overlay -->
    <div id="initial-loader" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container header-content">
            <h1 class="logo">
                <i class="fas fa-drafting-compass logo-icon"></i>
                <span>CostFur</span>
            </h1>
            <div id="auth-container">
                <div id="logged-in-view" class="hidden">
                    <span id="user-expiry-display" class="user-expiry hidden"></span>
                    <span id="user-email-display" class="user-email"></span>
                    <button id="logout-btn" class="btn btn-danger btn-sm">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Đăng xuất</span>
                    </button>
                </div>
                <div id="logged-out-view">
                    <button id="open-login-modal-btn" class="btn btn-primary btn-sm">Đăng nhập / Đăng ký</button>
                </div>
            </div>
        </div>
    </header>

    <div class="dashboard-layout">
        <nav id="main-nav" class="sidebar" role="navigation" aria-label="Main navigation">
            <a href="#" role="tab" id="tab-btn-calculator" aria-selected="true" aria-controls="calculator-tab" data-tab="calculator" class="sidebar-link active">
                <i class="fas fa-magic fa-fw"></i><span>Tạo Dự Án</span>
            </a>
            <a href="#" role="tab" id="tab-btn-quick-calc" aria-selected="false" aria-controls="quick-calc-tab" data-tab="quick-calc" class="sidebar-link">
                <i class="fas fa-calculator fa-fw"></i><span>Tính Nhanh</span>
            </a>
            <a href="#" role="tab" id="tab-btn-materials" aria-selected="false" aria-controls="materials-tab" data-tab="materials" class="sidebar-link">
                <i class="fas fa-boxes fa-fw"></i><span>Kho Vật Tư</span>
            </a>
            <a href="#" role="tab" id="tab-btn-config" aria-selected="false" aria-controls="config-tab" data-tab="config" class="sidebar-link">
                <i class="fas fa-cogs fa-fw"></i><span>Cấu hình</span>
            </a>
            <a href="#" role="tab" id="tab-btn-saved" aria-selected="false" aria-controls="saved-tab" data-tab="saved" class="sidebar-link">
                <i class="fas fa-folder-open fa-fw"></i><span>Dự Án</span>
            </a>
            <a href="#" role="tab" id="tab-btn-admin" aria-selected="false" aria-controls="admin-tab" data-tab="admin" class="sidebar-link hidden">
                <i class="fas fa-user-shield fa-fw"></i><span>Admin</span>
            </a>
            <a href="#" role="tab" id="tab-btn-update" aria-selected="false" aria-controls="update-tab" data-tab="update" class="sidebar-link">
                <i class="fas fa-rocket fa-fw"></i><span>Update</span>
            </a>
        </nav>

        <main id="tab-content" class="main-content">
            <!-- Tab 1: Trình Báo Giá -->
            <div id="calculator-tab" role="tabpanel" aria-labelledby="tab-btn-calculator" class="tab-pane active">
                <div class="grid-layout">
                    <div class="card main-card">
                        <h2 class="card-header">Tạo Dự Án Mới</h2>
                        <div class="content-wrapper calculator-form-content">
                            <!-- Step 1: Product Info -->
                            <div class="form-section no-top-border">
                                <h3 class="form-section-header"><span class="step-circle">1</span>Thông tin & Kích thước Sản phẩm</h3>
                                <div class="grid-2-col">
                                    <div class="form-group" style="margin-top:0;">
                                        <label for="item-name" class="form-label">Tên sản phẩm / dự án</label>
                                        <input type="text" id="item-name" class="input-style" placeholder="Vd: Tủ bếp dưới chân sắt">
                                    </div>
                                    <div class="form-group" style="margin-top:0;">
                                         <label for="item-type-input" class="form-label">Loại sản phẩm</label>
                                         <div id="item-type-combobox" class="combobox-container">
                                             <input type="text" id="item-type-input" class="input-style combobox-input" placeholder="Tìm hoặc chọn loại sản phẩm...">
                                             <input type="hidden" id="item-type" class="combobox-value">
                                             <div class="combobox-options-wrapper">
                                                 <ul class="combobox-options"></ul>
                                             </div>
                                         </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="item-description" class="form-label">Ghi chú / Mô tả Sản phẩm</label>
                                    <textarea id="item-description" class="input-style" placeholder="Thêm mô tả chi tiết về sản phẩm, yêu cầu đặc biệt..."></textarea>
                                </div>
                                <div class="grid-3-col" style="margin-top: 1.25rem;">
                                    <div><label for="item-length" class="form-label">Dài (mm)</label><input type="text" inputmode="decimal" id="item-length" class="input-style" placeholder="Vd: 2000"></div>
                                    <div><label for="item-width" class="form-label">Rộng (mm)</label><input type="text" inputmode="decimal" id="item-width" class="input-style" placeholder="Vd: 600"></div>
                                    <div><label for="item-height" class="form-label">Cao (mm)</label><input type="text" inputmode="decimal" id="item-height" class="input-style" placeholder="Vd: 850"></div>
                                </div>
                            </div>

                            <!-- Step 2: Components & Materials -->
                            <div class="form-section">
                                <h3 class="form-section-header"><span class="step-circle">2</span>Cấu thành & Vật liệu Ván</h3>
                                <div class="form-group">
                                    <label class="form-label">Vật liệu ván</label>
                                    <div class="grid-2-col">
                                        <div>
                                            <label for="main-material-wood-input" class="sub-label">Ván chính (Thùng, cánh)</label>
                                            <div id="main-material-wood-combobox" class="combobox-container">
                                                <input type="text" id="main-material-wood-input" class="input-style combobox-input" placeholder="Tìm hoặc chọn loại ván...">
                                                <input type="hidden" class="combobox-value">
                                                <div class="combobox-options-wrapper">
                                                    <ul class="combobox-options"></ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label for="main-material-back-panel-input" class="sub-label">Ván hậu tủ (nếu khác ván chính)</label>
                                            <div id="main-material-back-panel-combobox" class="combobox-container">
                                                <input type="text" id="main-material-back-panel-input" class="input-style combobox-input" placeholder="Tìm hoặc chọn loại ván...">
                                                <input type="hidden" class="combobox-value">
                                                <div class="combobox-options-wrapper">
                                                    <ul class="combobox-options"></ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="component-header">
                                        <label class="form-label">
                                            Danh sách Chi tiết Cấu thành
                                            <span class="tooltip-icon-wrapper">
                                                <i class="fas fa-question-circle tooltip-icon"></i>
                                                <span class="tooltip-text">Kích thước được tính tự động từ công thức. Bạn có thể chọn vật liệu riêng cho từng chi tiết.</span>
                                            </span>
                                        </label>
                                    </div>
                                    <div class="component-group-adder">
                                        <label class="form-label">Thêm Nhanh Cụm Chi tiết</label>
                                        <div class="accessory-adder">
                                            <div id="add-group-combobox" class="combobox-container">
                                                <input type="text" class="input-style combobox-input" placeholder="Tìm một cụm chi tiết...">
                                                <input type="hidden" class="combobox-value">
                                                <div class="combobox-options-wrapper"><ul class="combobox-options"></ul></div>
                                            </div>
                                            <input type="text" inputmode="decimal" id="add-group-quantity" class="input-style accessory-qty" placeholder="SL Cụm" value="1" min="1">
                                            <button id="add-group-btn" class="btn btn-secondary accessory-add-btn"><i class="fas fa-plus-circle"></i> Thêm Cụm</button>
                                        </div>
                                    </div>
                                    <div class="table-wrapper">
                                        <table id="component-table" class="data-table component-table">
                                            <thead>
                                                <tr>
                                                    <th class="th-style th-name">Tên Chi tiết</th>
                                                    <th class="th-style" style="width: 25%;">Vật liệu</th>
                                                    <th class="th-style">Dài</th>
                                                    <th class="th-style">Rộng</th>
                                                    <th class="th-style">SL</th>
                                                    <th class="th-style text-center th-delete">Xóa</th>
                                                </tr>
                                            </thead>
                                            <tbody id="components-table-body">
                                                <!-- JS will render component rows here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <button id="add-custom-component-btn" class="btn btn-secondary btn-sm" style="margin-top: 1rem;"><i class="fas fa-plus"></i> Thêm Chi tiết</button>
                                </div>
                            </div>
                            
                            <!-- Step 3: Accessories & Costs -->
                             <div class="form-section">
                                <h3 class="form-section-header"><span class="step-circle">3</span>Phụ kiện & Chi phí Hoàn thiện</h3>
                                <div class="form-group">
                                    <label for="edge-material-input" class="form-label">
                                        Vật liệu nẹp cạnh
                                        <span class="tooltip-icon-wrapper">
                                            <i class="fas fa-question-circle tooltip-icon"></i>
                                            <span class="tooltip-text">Chọn loại nẹp để tính chi phí dán cạnh tự động. Quy tắc dán cạnh được thiết lập trong tab Cấu hình.</span>
                                        </span>
                                    </label>
                                    <div id="edge-material-combobox" class="combobox-container">
                                        <input type="text" id="edge-material-input" class="input-style combobox-input" placeholder="Tìm hoặc chọn loại nẹp...">
                                        <input type="hidden" class="combobox-value">
                                        <div class="combobox-options-wrapper">
                                            <ul class="combobox-options"></ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="material-accessories" class="form-label">
                                        Vật tư phụ & Phụ kiện khác
                                        <span class="tooltip-icon-wrapper">
                                            <i class="fas fa-question-circle tooltip-icon"></i>
                                            <span class="tooltip-text">Thêm các phụ kiện khác như bản lề, ray trượt, chi phí gia công tại đây.</span>
                                        </span>
                                    </label>
                                    <div class="accessory-adder">
                                        <div id="main-material-accessories-combobox" class="combobox-container">
                                            <input type="text" class="input-style combobox-input" placeholder="Tìm phụ kiện, gia công, nẹp...">
                                            <input type="hidden" class="combobox-value">
                                            <div class="combobox-options-wrapper">
                                                <ul class="combobox-options"></ul>
                                            </div>
                                        </div>
                                        <input type="text" inputmode="decimal" id="accessory-quantity" class="input-style accessory-qty" placeholder="SL / mét" value="1" min="1">
                                        <button id="add-accessory-btn" class="btn btn-secondary accessory-add-btn"><i class="fas fa-plus"></i> Thêm</button>
                                    </div>
                                    <ul id="accessories-list" class="accessory-list"></ul>
                                </div>
                                <div class="grid-2-col" style="margin-top: 1.25rem;">
                                    <div class="form-group" style="margin-top: 0;">
                                        <label for="labor-cost" class="form-label">Chi phí nhân công (VND)</label>
                                        <input type="text" inputmode="decimal" id="labor-cost" class="input-style" value="0" placeholder="Vd: 500000">
                                    </div>
                                    <div class="form-group" style="margin-top: 0;">
                                        <label for="profit-margin" class="form-label">Lợi nhuận mong muốn (%)</label>
                                        <input type="text" inputmode="decimal" id="profit-margin" class="input-style" value="50">
                                    </div>
                                </div>
                            </div>
                           
                            <div class="main-actions-group">
                                <button id="clear-form-btn" class="btn btn-secondary">
                                    <i class="fas fa-file"></i> Tạo Mới
                                </button>
                                <button id="update-item-btn" class="btn btn-success hidden" disabled>
                                    <i class="fas fa-sync-alt"></i> Cập nhật Dự án
                                </button>
                                <button id="save-item-btn" class="btn btn-primary" disabled>
                                    <i class="fas fa-save"></i> Lưu Dự án
                                </button>
                            </div>

                            <!-- Results Section -->
                            <div id="results-section" class="hidden">
                                <div id="results-content">
                                    <div id="price-summary-container" class="result-box">
                                        <div class="grid-3-col">
                                            <div class="price-card bg-indigo">
                                                <div class="price-label">Tổng Chi Phí</div>
                                                <div id="total-cost-value" class="price-value">0đ</div>
                                                <div class="price-sublabel">Gồm vật tư và nhân công</div>
                                            </div>
                                            <div class="price-card bg-yellow">
                                                <div class="price-label">Giá Bán Đề Xuất</div>
                                                <div id="suggested-price-value" class="price-value">0đ</div>
                                                <div class="price-sublabel">Đã gồm lợi nhuận mong muốn</div>
                                            </div>
                                            <div class="price-card bg-green">
                                                <div class="price-label">Lợi Nhuận Ước Tính</div>
                                                <div id="estimated-profit-value" class="price-value">0đ</div>
                                                <div class="price-sublabel">Sau khi trừ mọi chi phí</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="cost-breakdown-container" class="result-box"></div>
                                </div>
                            </div>
                        </div>
                        <div class="login-prompt-view">
                            <div class="icon-prompt"><i class="fas fa-lock"></i></div>
                            <h3>Tính năng dành cho thành viên</h3>
                            <p>Vui lòng đăng nhập để bắt đầu báo giá và lưu dự án của bạn.</p>
                        </div>
                    </div>
                    <div class="sidebar-card card">
                        <h2 class="card-header">Công cụ & Hướng dẫn</h2>
                        <div class="content-wrapper calculator-form-content">
                            <!-- Product Preview -->
                             <div id="product-preview-section">
                                <h4><i class="fas fa-image"></i> Hình ảnh Sản phẩm</h4>
                                <input type="file" id="sidebar-image-input" class="hidden" accept="image/*">
                                <div id="sidebar-image-preview-wrapper" class="preview-canvas">
                                    <img id="sidebar-image-preview" src="" alt="Xem trước hình ảnh" class="hidden">
                                    <div id="sidebar-image-placeholder">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Nhấp hoặc kéo thả ảnh vào đây</p>
                                    </div>
                                    <button id="sidebar-remove-image-btn" class="remove-image-btn hidden">&times;</button>
                                </div>
                            </div>
                        </div>
                         <div class="login-prompt-view">
                            <div class="icon-prompt"><i class="fas fa-info-circle"></i></div>
                            <h3>Chào mừng bạn!</h3>
                            <p>Đăng nhập để mở khóa tất cả tính năng.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Quick Calculator -->
            <div id="quick-calc-tab" role="tabpanel" aria-labelledby="tab-btn-quick-calc" class="tab-pane hidden">
                <div class="card">
                    <h2 class="card-header">
                        <i class="fas fa-calculator" style="margin-right: 0.75rem;"></i>Tính Giá Nhanh
                        <span class="tooltip-icon-wrapper">
                            <i class="fas fa-question-circle tooltip-icon"></i>
                            <span class="tooltip-text">Công cụ này giúp bạn ước tính nhanh chi phí dựa trên tổng số vật tư. Mọi thay đổi sẽ được tự động cập nhật vào kết quả bên dưới.</span>
                        </span>
                    </h2>
                    <div class="content-wrapper quick-calc-form-content">
                        
                        <!-- Section 1: Board Materials -->
                        <div class="form-group" style="margin-top: 1rem;">
                            <h3 class="result-box-header" style="margin-bottom: 1.5rem; font-size: 1.1rem;"><span class="step-circle">1</span>Vật liệu ván</h3>
                            <div class="grid-2-col" style="gap: 0.5rem 1.25rem;">
                                <div>
                                    <label for="qc-area" class="form-label">Diện tích ván loại 1 (m²)</label>
                                    <input type="text" inputmode="decimal" id="qc-area" class="input-style" placeholder="Vd: 4.5">
                                </div>
                                <div>
                                    <label for="qc-material-wood-input" class="form-label">Loại ván 1 (Chính)</label>
                                    <div id="qc-material-wood-combobox" class="combobox-container">
                                        <input type="text" id="qc-material-wood-input" class="input-style combobox-input" placeholder="Tìm hoặc chọn loại ván...">
                                        <input type="hidden" class="combobox-value">
                                        <div class="combobox-options-wrapper">
                                            <ul class="combobox-options"></ul>
                                        </div>
                                    </div>
                                    <small id="qc-sheet-count-display" class="form-text" style="margin-top: 0.5rem; text-align: right; color: var(--primary-color); font-weight: 500;"></small>
                                </div>
                            </div>
                            <div class="grid-2-col" style="gap: 0.5rem 1.25rem; margin-top: 1.25rem;">
                                <div>
                                    <label for="qc-area-2" class="form-label">Diện tích ván loại 2 (m²)</label>
                                    <input type="text" inputmode="decimal" id="qc-area-2" class="input-style" placeholder="Vd: 1.2">
                                </div>
                                <div>
                                    <label for="qc-material-wood-2-input" class="form-label">Loại ván 2 (Phụ)</label>
                                    <div id="qc-material-wood-2-combobox" class="combobox-container">
                                        <input type="text" id="qc-material-wood-2-input" class="input-style combobox-input" placeholder="Tìm hoặc chọn loại ván...">
                                        <input type="hidden" class="combobox-value">
                                        <div class="combobox-options-wrapper">
                                            <ul class="combobox-options"></ul>
                                        </div>
                                    </div>
                                    <small id="qc-sheet-count-display-2" class="form-text" style="margin-top: 0.5rem; text-align: right; color: var(--primary-color); font-weight: 500;"></small>
                                </div>
                            </div>
                        </div>

                        <!-- Section 2: Accessories, Edge, and Other Costs -->
                        <div class="form-group">
                             <h3 class="result-box-header" style="margin-bottom: 1.5rem; font-size: 1.1rem;"><span class="step-circle">2</span>Phụ kiện, Nẹp & Chi phí Phát sinh</h3>
                            <div class="accessory-adder qc-accessory-adder">
                                <div id="qc-material-accessories-combobox" class="combobox-container">
                                    <input type="text" class="input-style combobox-input" placeholder="Tìm phụ kiện hoặc nẹp...">
                                    <input type="hidden" class="combobox-value">
                                    <div class="combobox-options-wrapper">
                                        <ul class="combobox-options"></ul>
                                    </div>
                                </div>
                                <input type="text" inputmode="decimal" id="qc-accessory-quantity" class="input-style accessory-qty" placeholder="SL / mét" value="1" min="0">
                                <button id="qc-add-accessory-btn" class="btn btn-secondary accessory-add-btn"><i class="fas fa-plus"></i> Thêm</button>
                            </div>
                            <ul id="qc-accessories-list" class="accessory-list" style="margin-top: 1rem; margin-bottom: 1.25rem;"></ul>
                        </div>

                        <!-- Section 3: Pricing Setup -->
                        <div class="form-group">
                            <h3 class="result-box-header" style="margin-bottom: 1.5rem; font-size: 1.1rem;"><span class="step-circle">3</span>Thiết lập Giá bán</h3>
                            <div class="grid-2-col" style="gap: 0.5rem 1.25rem;">
                                 <div>
                                    <label for="qc-install-cost" class="form-label">Chi phí lắp đặt & phát sinh (VND)</label>
                                    <input type="text" inputmode="decimal" id="qc-install-cost" class="input-style" placeholder="Vd: 500000" value="0" min="0">
                                </div>
                                <div>
                                    <label for="qc-profit-margin" class="form-label">Lợi nhuận mong muốn (%)</label>
                                    <input type="text" inputmode="decimal" id="qc-profit-margin" class="input-style" value="50" min="0">
                                </div>
                            </div>
                        </div>

                        <!-- Section 4: Results -->
                        <div id="qc-results-container" style="margin-top: 2rem; border-top: 1px solid var(--border-color); padding-top: 2rem;">
                             <div class="grid-3-col">
                                <div class="price-card bg-indigo">
                                    <div class="price-label">Tổng Chi Phí</div>
                                    <div id="qc-total-cost-value" class="price-value">0đ</div>
                                    <div class="price-sublabel">Gồm tất cả vật tư và chi phí</div>
                                </div>
                                <div class="price-card bg-yellow">
                                    <div class="price-label">Giá Bán Đề Xuất</div>
                                    <div id="qc-suggested-price-value" class="price-value">0đ</div>
                                    <div class="price-sublabel">Đã gồm lợi nhuận mong muốn</div>
                                </div>
                                <div class="price-card bg-green">
                                    <div class="price-label">Lợi Nhuận Ước Tính</div>
                                    <div id="qc-estimated-profit-value" class="price-value">0đ</div>
                                    <div class="price-sublabel">Sau khi trừ mọi chi phí</div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="login-prompt-view">
                        <div class="icon-prompt"><i class="fas fa-calculator"></i></div>
                        <h3>Tính toán nhanh chóng</h3>
                        <p>Vui lòng đăng nhập để sử dụng công cụ tính giá nhanh dựa trên kho vật tư của bạn.</p>
                    </div>
                </div>
            </div>

            <!-- Tab 2: Quản lý Vật tư -->
            <div id="materials-tab" role="tabpanel" aria-labelledby="tab-btn-materials" class="tab-pane hidden">
                <div class="card">
                    <h2 class="card-header">Quản lý Kho Vật tư</h2>
                    <div class="content-wrapper materials-form-content">
                        <form id="material-form" class="material-form">
                            <input type="hidden" id="material-id">
                            <div class="grid-2-col">
                                <div>
                                    <label for="material-name" class="form-label">Tên vật tư</label>
                                    <input type="text" id="material-name" class="input-style" placeholder="Vd: Ván MDF An Cường 17mm" required>
                                </div>
                                <div>
                                    <label for="material-type" class="form-label">Loại vật tư</label>
                                    <select id="material-type" class="input-style" required>
                                        <option value="Ván">Ván</option>
                                        <option value="Cạnh">Cạnh</option>
                                        <option value="Phụ kiện">Phụ kiện</option>
                                        <option value="Gia Công">Gia Công</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid-2-col">
                                <div>
                                    <label for="material-price" class="form-label">Đơn giá</label>
                                    <input type="text" inputmode="decimal" id="material-price" class="input-style" placeholder="Vd: 550000" required>
                                </div>
                                <div>
                                    <label for="material-unit" class="form-label">Đơn vị tính</label>
                                    <input type="text" id="material-unit" class="input-style" placeholder="Vd: tấm, mét, cái" required>
                                </div>
                            </div>
                            <div>
                                <label for="material-notes" class="form-label">Ghi chú</label>
                                <input type="text" id="material-notes" class="input-style" placeholder="Vd: Khổ 1220x2440, chống ẩm">
                            </div>
                            <div class="button-group" style="justify-content: flex-end;">
                                <button type="button" id="cancel-edit-button" class="btn btn-secondary hidden">Hủy</button>
                                <button type="submit" class="btn btn-primary"><i class="fas fa-plus mr-2"></i> Thêm Vật tư</button>
                            </div>
                        </form>
                        <div class="table-container">
                             <h3 class="table-header">Danh sách Vật tư</h3>
                             <div class="material-controls">
                                <div class="filter-wrapper">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="material-filter-input" class="input-style" placeholder="Lọc theo tên hoặc ghi chú...">
                                </div>
                                <select id="material-sort-select" class="input-style">
                                    <option value="name-asc">Sắp xếp: Tên A-Z</option>
                                    <option value="name-desc">Sắp xếp: Tên Z-A</option>
                                    <option value="price-asc">Sắp xếp: Giá thấp nhất</option>
                                    <option value="price-desc">Sắp xếp: Giá cao nhất</option>
                                    <option value="type">Sắp xếp: Loại vật tư</option>
                                </select>
                             </div>
                            <div class="table-wrapper">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th class="th-style">Tên</th>
                                            <th class="th-style">Loại</th>
                                            <th class="th-style">Đơn giá</th>
                                            <th class="th-style">Ghi chú</th>
                                            <th class="th-style text-center">Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="materials-table-body">
                                        <!-- JS will render here -->
                                    </tbody>
                                </table>
                            </div>
                             <div id="pagination-controls" class="pagination-controls hidden">
                                <span id="page-info"></span>
                                <div class="button-group" style="margin: 0; justify-content: flex-end;">
                                    <button id="prev-page-btn" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Trước</button>
                                    <button id="next-page-btn" class="btn btn-secondary">Sau <i class="fas fa-arrow-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="login-prompt-view">
                        <div class="icon-prompt"><i class="fas fa-boxes"></i></div>
                        <h3>Quản lý vật tư của bạn</h3>
                        <p>Vui lòng đăng nhập để thêm, sửa, xóa các loại vật tư cho xưởng của mình.</p>
                    </div>
                </div>
            </div>

            <!-- Tab: Configuration -->
            <div id="config-tab" role="tabpanel" aria-labelledby="tab-btn-config" class="tab-pane hidden">
                <div class="card">
                    <h2 class="card-header">Quản lý Loại Sản Phẩm</h2>
                    <div class="content-wrapper config-form-content">
                        <div class="config-layout">
                            <!-- Left: List of Product Types -->
                            <div class="config-list-panel">
                                 <form id="product-type-form">
                                    <input type="hidden" id="product-type-id">
                                    <div class="form-group" style="margin-top: 0;">
                                        <label for="product-type-name" class="form-label">Tên Loại Sản Phẩm</label>
                                        <input type="text" id="product-type-name" class="input-style" placeholder="Vd: Tủ Bếp Dưới" required>
                                    </div>
                                    <div class="button-group" style="justify-content: flex-start; margin-top: 0.75rem;">
                                        <button type="submit" class="btn btn-primary"><i class="fas fa-plus mr-2"></i> Thêm Mới</button>
                                        <button type="button" id="cancel-product-type-edit-btn" class="btn btn-secondary hidden">Hủy</button>
                                    </div>
                                </form>
                                <hr class="form-divider">
                                <div id="product-types-list" class="config-list">
                                    <!-- JS renders list here -->
                                </div>
                            </div>

                            <!-- Right: Editor for the selected Product Type -->
                            <div id="product-type-editor" class="config-editor-panel hidden">
                                <h3 id="product-type-editor-title" class="table-header">Chỉnh sửa: Tủ Bếp Dưới</h3>
                                <div class="form-group" style="margin-top: 0;">
                                    <label class="form-label">Thêm chi tiết vào loại sản phẩm</label>
                                    <div class="accessory-adder">
                                        <div id="pt-component-add-combobox" class="combobox-container">
                                            <input type="text" class="input-style combobox-input" placeholder="Tìm tên chi tiết...">
                                            <input type="hidden" class="combobox-value">
                                            <div class="combobox-options-wrapper"><ul class="combobox-options"></ul></div>
                                        </div>
                                        <input type="text" inputmode="decimal" id="pt-component-add-qty" class="input-style accessory-qty" placeholder="SL" value="1" min="1">
                                        <button id="pt-component-add-btn" class="btn btn-secondary accessory-add-btn"><i class="fas fa-plus"></i> Thêm</button>
                                    </div>
                                </div>
                                <div class="table-container">
                                    <h4 class="config-sub-header">Danh sách chi tiết hiện tại</h4>
                                     <div class="table-wrapper">
                                        <table class="data-table">
                                            <thead>
                                                <tr>
                                                    <th class="th-style">Tên Chi tiết</th>
                                                    <th class="th-style text-center">Số lượng</th>
                                                    <th class="th-style text-center">Xóa</th>
                                                </tr>
                                            </thead>
                                            <tbody id="pt-components-list">
                                                <!-- JS renders components for selected type here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                     <div class="login-prompt-view">
                        <div class="icon-prompt"><i class="fas fa-cogs"></i></div>
                        <h3>Cấu hình sản phẩm</h3>
                        <p>Vui lòng đăng nhập để tạo và quản lý các mẫu sản phẩm của bạn.</p>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <h2 class="card-header">
                        Quản lý Nhóm Chi tiết (Cụm)
                        <span class="tooltip-icon-wrapper">
                            <i class="fas fa-question-circle tooltip-icon"></i>
                            <span class="tooltip-text">Tạo các cụm chi tiết có thể tái sử dụng, ví dụ như "Cụm hộc kéo", để thêm nhanh vào các dự án.</span>
                        </span>
                    </h2>
                    <div class="content-wrapper config-form-content">
                        <div class="config-layout">
                            <!-- Left: List of Component Groups -->
                            <div class="config-list-panel">
                                <form id="component-group-form">
                                    <input type="hidden" id="component-group-id">
                                    <div class="form-group" style="margin-top: 0;">
                                        <label for="component-group-name" class="form-label">Tên Nhóm / Cụm</label>
                                        <input type="text" id="component-group-name" class="input-style" placeholder="Vd: Cụm Hộc Kéo" required>
                                    </div>
                                    <div class="button-group" style="justify-content: flex-start; margin-top: 0.75rem;">
                                        <button type="submit" class="btn btn-primary"><i class="fas fa-plus mr-2"></i> Thêm Mới</button>
                                        <button type="button" id="cancel-component-group-edit-btn" class="btn btn-secondary hidden">Hủy</button>
                                    </div>
                                </form>
                                <hr class="form-divider">
                                <div id="component-groups-list" class="config-list">
                                    <!-- JS renders list here -->
                                </div>
                            </div>

                            <!-- Right: Editor for the selected Component Group -->
                            <div id="component-group-editor" class="config-editor-panel hidden">
                                <h3 id="component-group-editor-title" class="table-header">Chỉnh sửa: Cụm Hộc Kéo</h3>
                                <div class="form-group" style="margin-top: 0;">
                                    <label class="form-label">Thêm chi tiết vào nhóm</label>
                                    <div class="accessory-adder">
                                        <div id="cg-component-add-combobox" class="combobox-container">
                                            <input type="text" class="input-style combobox-input" placeholder="Tìm tên chi tiết...">
                                            <input type="hidden" class="combobox-value">
                                            <div class="combobox-options-wrapper"><ul class="combobox-options"></ul></div>
                                        </div>
                                        <input type="text" inputmode="decimal" id="cg-component-add-qty" class="input-style accessory-qty" placeholder="SL" value="1" min="1">
                                        <button id="cg-component-add-btn" class="btn btn-secondary accessory-add-btn"><i class="fas fa-plus"></i> Thêm</button>
                                    </div>
                                </div>
                                <div class="table-container">
                                    <h4 class="config-sub-header">Danh sách chi tiết hiện tại trong nhóm</h4>
                                    <div class="table-wrapper">
                                        <table class="data-table">
                                            <thead>
                                                <tr>
                                                    <th class="th-style">Tên Chi tiết</th>
                                                    <th class="th-style text-center">Số lượng</th>
                                                    <th class="th-style text-center">Xóa</th>
                                                </tr>
                                            </thead>
                                            <tbody id="cg-components-list">
                                                <!-- JS renders components for selected group here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                     <div class="login-prompt-view">
                        <div class="icon-prompt"><i class="fas fa-cubes"></i></div>
                        <h3>Tạo cụm chi tiết</h3>
                        <p>Vui lòng đăng nhập để quản lý các nhóm chi tiết có thể tái sử dụng.</p>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <h2 class="card-header">Quản lý Tên Chi tiết & Công thức</h2>
                    <div class="content-wrapper component-names-content">
                        <form id="component-name-form" class="material-form">
                            <input type="hidden" id="component-name-id">
                            <div>
                                <label for="component-name-input" class="form-label">Tên chi tiết</label>
                                <input type="text" id="component-name-input" class="input-style" placeholder="Vd: Hông Trái, Đáy, Nóc..." required>
                            </div>
                             <div class="grid-2-col" style="margin-top: 1rem;">
                                <div>
                                    <label for="component-length-formula" class="form-label">
                                        Công thức tính Chiều Dài
                                        <span class="tooltip-icon-wrapper">
                                            <i class="fas fa-question-circle tooltip-icon"></i>
                                            <span class="tooltip-text">Biến: L, W, H, t (Dài, Rộng, Cao, Dày ván)</span>
                                        </span>
                                    </label>
                                    <input type="text" id="component-length-formula" class="input-style" placeholder="Vd: L - 2*t">
                                </div>
                                <div>
                                    <label for="component-width-formula" class="form-label">Công thức tính Chiều Rộng</label>
                                    <input type="text" id="component-width-formula" class="input-style" placeholder="Vd: W">
                                </div>
                            </div>
                            <div class="form-group" style="margin-top: 1rem;">
                                <label class="form-label">
                                    Quy tắc dán cạnh mặc định
                                    <span class="tooltip-icon-wrapper">
                                        <i class="fas fa-question-circle tooltip-icon"></i>
                                        <span class="tooltip-text">Xác định các cạnh sẽ được tính chi phí nẹp tự động. D1/D2 là 2 cạnh dài, R1/R2 là 2 cạnh rộng của chi tiết.</span>
                                    </span>
                                </label>
                                <div class="edge-banding-rules">
                                    <label><input type="checkbox" id="component-edge-1"> Cạnh dài 1</label>
                                    <label><input type="checkbox" id="component-edge-2"> Cạnh dài 2</label>
                                    <label><input type="checkbox" id="component-edge-3"> Cạnh rộng 1</label>
                                    <label><input type="checkbox" id="component-edge-4"> Cạnh rộng 2</label>
                                </div>
                            </div>
                            <div class="button-group" style="justify-content: flex-end;">
                                <button type="button" id="cancel-component-name-edit-btn" class="btn btn-secondary hidden">Hủy</button>
                                <button type="submit" class="btn btn-primary"><i class="fas fa-plus mr-2"></i> Thêm Tên</button>
                            </div>
                        </form>
                        <div class="table-container">
                            <h3 class="table-header">Danh sách Tên Chi tiết</h3>
                            <div class="material-controls">
                               <div class="filter-wrapper">
                                   <i class="fas fa-search"></i>
                                   <input type="text" id="cn-filter-input" class="input-style" placeholder="Lọc theo tên...">
                               </div>
                            </div>
                            <div class="table-wrapper">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th class="th-style" style="width: 25%;">Tên</th>
                                            <th class="th-style">CT Dài</th>
                                            <th class="th-style">CT Rộng</th>
                                            <th class="th-style text-center" colspan="4">Dán cạnh (D1-D2-R1-R2)</th>
                                            <th class="th-style text-center" style="width: 15%;">Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="component-names-table-body">
                                        <!-- JS will render here -->
                                    </tbody>
                                </table>
                            </div>
                            <div id="cn-pagination-controls" class="pagination-controls hidden">
                                <span id="cn-page-info"></span>
                                <div class="button-group" style="margin: 0; justify-content: flex-end;">
                                    <button id="cn-prev-page-btn" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Trước</button>
                                    <button id="cn-next-page-btn" class="btn btn-secondary">Sau <i class="fas fa-arrow-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="login-prompt-view">
                        <div class="icon-prompt"><i class="fas fa-list-alt"></i></div>
                        <h3>Tùy chỉnh danh sách chi tiết</h3>
                        <p>Vui lòng đăng nhập để quản lý danh sách tên chi tiết của bạn.</p>
                    </div>
                </div>
            </div>


            <!-- Tab 4: Dự án đã lưu -->
            <div id="saved-tab" role="tabpanel" aria-labelledby="tab-btn-saved" class="tab-pane hidden">
                 <div class="card">
                    <h2 class="card-header">Các Dự án Đã Lưu</h2>
                    <div class="content-wrapper saved-items-content">
                        <div class="material-controls">
                            <div class="filter-wrapper">
                                <i class="fas fa-search"></i>
                                <input type="text" id="saved-items-filter-input" class="input-style" placeholder="Lọc theo tên dự án, ghi chú, hoặc vật liệu...">
                            </div>
                        </div>
                        <div class="table-container">
                            <div class="table-wrapper">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th class="th-style" style="width: 35%;">Tên & Chi tiết Dự án</th>
                                            <th class="th-style">Giá Bán</th>
                                            <th class="th-style">Chi Phí</th>
                                            <th class="th-style">Lợi Nhuận</th>
                                            <th class="th-style">Ngày tạo</th>
                                            <th class="th-style text-center">Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="saved-items-table-body">
                                        <!-- JS will render here -->
                                    </tbody>
                                </table>
                            </div>
                            <div id="saved-items-pagination-controls" class="pagination-controls hidden">
                                <span id="si-page-info"></span>
                                <div class="button-group" style="margin: 0; justify-content: flex-end;">
                                    <button id="si-prev-page-btn" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Trước</button>
                                    <button id="si-next-page-btn" class="btn btn-secondary">Sau <i class="fas fa-arrow-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="login-prompt-view">
                        <div class="icon-prompt"><i class="fas fa-folder-open"></i></div>
                        <h3>Xem lại dự án</h3>
                        <p>Vui lòng đăng nhập để xem các dự án đã lưu của bạn.</p>
                    </div>
                </div>
            </div>

            <!-- Tab: Admin Panel -->
            <div id="admin-tab" role="tabpanel" aria-labelledby="tab-btn-admin" class="tab-pane hidden">
                <div class="card">
                    <h2 class="card-header"><i class="fas fa-users-cog" style="margin-right: 0.75rem;"></i>Quản lý Người dùng</h2>
                    <div class="content-wrapper admin-content">
                        <div class="material-controls">
                            <div class="filter-wrapper">
                                <i class="fas fa-search"></i>
                                <input type="text" id="admin-user-filter-input" class="input-style" placeholder="Lọc theo email hoặc tên...">
                            </div>
                        </div>
                        <div class="table-container">
                            <div class="table-wrapper">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th class="th-style" style="width: 25%;">Email</th>
                                            <th class="th-style">Tên hiển thị</th>
                                            <th class="th-style" style="width: 15%;">Vai trò</th>
                                            <th class="th-style" style="width: 15%;">Trạng thái</th>
                                            <th class="th-style" style="width: 15%;">Thời hạn (ngày)</th>
                                            <th class="th-style">Đăng nhập cuối</th>
                                        </tr>
                                    </thead>
                                    <tbody id="admin-user-list-tbody">
                                        <!-- User list rendered by script.js -->
                                    </tbody>
                                </table>
                            </div>
                            <div id="admin-user-pagination-controls" class="pagination-controls hidden">
                                <span id="au-page-info"></span>
                                <div class="button-group" style="margin: 0; justify-content: flex-end;">
                                    <button id="au-prev-page-btn" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Trước</button>
                                    <button id="au-next-page-btn" class="btn btn-secondary">Sau <i class="fas fa-arrow-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <h2 class="card-header"><i class="fas fa-cogs" style="margin-right: 0.75rem;"></i>Cài đặt Chung</h2>
                    <div class="content-wrapper admin-content">
                        <form id="admin-settings-form">
                             <div class="form-group">
                                <label for="admin-default-trial-days" class="form-label">Số ngày dùng thử mặc định</label>
                                <input type="text" inputmode="decimal" id="admin-default-trial-days" class="input-style" placeholder="Vd: 7">
                                <small class="form-text">Người dùng mới đăng ký sẽ tự động có thời hạn dùng thử bằng số ngày này.</small>
                            </div>
                            <div class="button-group" style="justify-content: flex-end; margin-top: 1.5rem;">
                                <button type="submit" class="btn btn-primary"><i class="fas fa-save mr-2"></i> Lưu Cài đặt</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <h2 class="card-header"><i class="fas fa-history" style="margin-right: 0.75rem;"></i>Quản lý Lịch sử Cập nhật</h2>
                    <div class="content-wrapper admin-content">
                        <form id="admin-update-log-form" class="material-form">
                            <input type="hidden" id="admin-update-id">
                            <div class="grid-2-col">
                                <div>
                                    <label for="admin-update-version" class="form-label">Phiên bản</label>
                                    <input type="text" id="admin-update-version" class="input-style" placeholder="Vd: 1.2.0" required>
                                </div>
                                <div>
                                    <label for="admin-update-date" class="form-label">Ngày cập nhật</label>
                                    <input type="date" id="admin-update-date" class="input-style" required>
                                </div>
                            </div>
                            <div class="form-group" style="margin-top: 1rem;">
                                <label for="admin-update-link" class="form-label">Link Google Docs</label>
                                <input type="url" id="admin-update-link" class="input-style" placeholder="https://docs.google.com/document/d/..." required>
                            </div>
                            <div class="button-group" style="justify-content: flex-end;">
                                <button type="button" id="cancel-update-log-edit-btn" class="btn btn-secondary hidden">Hủy</button>
                                <button type="submit" class="btn btn-primary"><i class="fas fa-plus mr-2"></i> Thêm Phiên bản</button>
                            </div>
                        </form>
                        <div class="table-container">
                            <h3 class="table-header">Danh sách Phiên bản</h3>
                            <div id="admin-update-log-list" class="config-list">
                                <!-- Admin update log entries will be rendered here by script.js -->
                            </div>
                            <div id="admin-update-log-pagination-controls" class="pagination-controls hidden">
                                <span id="aul-page-info"></span>
                                <div class="button-group" style="margin: 0; justify-content: flex-end;">
                                    <button id="aul-prev-page-btn" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Trước</button>
                                    <button id="aul-next-page-btn" class="btn btn-secondary">Sau <i class="fas fa-arrow-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tab: Update Log -->
            <div id="update-tab" role="tabpanel" aria-labelledby="tab-btn-update" class="tab-pane hidden">
                <div class="card">
                    <h2 class="card-header"><i class="fas fa-rocket" style="margin-right: 0.75rem;"></i>Thông tin Cập nhật</h2>
                    <div id="update-log-content" class="content-wrapper update-content">
                        <!-- Dynamic content will be rendered here by script.js -->
                        <div class="loading-overlay">
                            <div class="spinner"></div>
                        </div>
                    </div>
                    <div id="update-log-pagination-controls" class="pagination-controls hidden">
                        <span id="ul-page-info"></span>
                        <div class="button-group" style="margin: 0; justify-content: flex-end;">
                            <button id="ul-prev-page-btn" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Trước</button>
                            <button id="ul-next-page-btn" class="btn btn-secondary">Sau <i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inactive User Overlay -->
            <div id="inactive-user-overlay" class="global-overlay hidden">
                <div class="overlay-content">
                    <i class="fas fa-lock overlay-icon"></i>
                    <h3 id="inactive-overlay-title">Tài khoản của bạn đã hết hạn</h3>
                    <p id="inactive-overlay-message">Vui lòng liên hệ quản trị viên để gia hạn và tiếp tục sử dụng các tính năng của ứng dụng.</p>
                    <button id="inactive-overlay-logout-btn" class="btn btn-primary">Đăng xuất</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="login-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="login-modal-title">
        <div class="modal-content login-modal-content">
            <button class="modal-close-btn" aria-label="Đóng modal">&times;</button>
            <div class="login-modal-header">
                <i class="fas fa-drafting-compass logo-icon"></i>
                <h3 id="login-modal-title" class="modal-title">Chào mừng tới CostFur</h3>
            </div>
            <p class="modal-subtitle">Đăng nhập để lưu trữ và quản lý dự án của bạn một cách chuyên nghiệp.</p>
            <div id="login-error" class="error-message"></div>
            <button id="google-login-btn" class="google-btn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" width="18" height="18">
                <span>Đăng nhập với Google</span>
            </button>
            <div class="remember-me-container">
                <input type="checkbox" id="remember-me-checkbox" checked>
                <label for="remember-me-checkbox">Duy trì đăng nhập</label>
            </div>
        </div>
    </div>
    
    <div id="view-item-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="view-item-title">
        <div class="modal-content modal-lg">
            <button class="modal-close-btn" aria-label="Đóng modal">&times;</button>
            <h3 id="view-item-title" class="modal-title" style="text-align: left;"></h3>
            <div id="view-item-content" class="modal-body"></div>
        </div>
    </div>

    <div id="confirm-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="confirm-modal-title">
        <div class="modal-content">
            <h3 id="confirm-modal-title" class="modal-title-sm">Xác nhận</h3>
            <p id="confirm-message" class="confirm-text"></p>
            <div class="confirm-actions">
                <button id="confirm-cancel-btn" class="btn btn-secondary">Hủy</button>
                <button id="confirm-ok-btn" class="btn btn-danger">Đồng ý</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>
    
    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 CostFur.</p>
    </footer>

    <!-- Scripts -->
    <script type="module" src="script.js"></script>

</body>
</html>