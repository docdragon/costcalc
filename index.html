<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CostCraft AI - Báo giá Nội thất Thông minh</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.8.0"
  }
}
</script>
</head>
<body>

    <!-- Initial Loading Overlay -->
    <div id="initial-loader" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container header-content">
            <h1 class="logo">
                <i class="fas fa-drafting-compass logo-icon"></i>
                <span>CostCraft AI</span>
            </h1>
            <div id="auth-container">
                <div id="logged-in-view" class="hidden">
                    <span id="user-email-display" class="user-email"></span>
                    <button id="logout-btn" class="btn btn-danger btn-sm">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Đăng xuất</span>
                    </button>
                </div>
                <div id="logged-out-view">
                    <button id="open-login-modal-btn" class="btn btn-primary btn-sm">Đăng nhập / Đăng ký</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container main-container">
        <!-- Intro Section -->
        <div class="intro-section">
            <h2>Báo giá Nội thất Thông minh</h2>
            <p>Sử dụng trí tuệ nhân tạo để phân tích chi phí, tối ưu hóa vật liệu và tạo báo giá chuyên nghiệp chỉ trong vài giây.</p>
        </div>

        <!-- Tab Navigation -->
        <div class="tabs-container">
            <nav id="tabs" class="tabs-nav">
                <button data-tab="calculator" class="tab-btn active"><i class="fas fa-magic"></i>Trình Báo Giá</button>
                <button data-tab="quick-calc" class="tab-btn"><i class="fas fa-calculator"></i>Tính Nhanh</button>
                <button data-tab="materials" class="tab-btn"><i class="fas fa-boxes"></i>Kho Vật Tư</button>
                <button data-tab="saved" class="tab-btn"><i class="fas fa-folder-open"></i>Dự Án</button>
            </nav>
        </div>

        <!-- Tab Content -->
        <main id="tab-content">
            <!-- Tab 1: Trình Báo Giá -->
            <div id="calculator-tab" class="tab-pane active">
                <div class="grid-layout">
                    <div class="card main-card">
                        <h2 class="card-header">Tạo Báo giá Mới</h2>
                        <div class="content-wrapper calculator-form-content">
                            <!-- AI Quick Config -->
                            <div class="ai-config-section">
                                <label for="ai-config-prompt" class="form-label"><i class="fas fa-wand-magic-sparkles"></i> Khởi tạo Nhanh với AI</label>
                                <textarea id="ai-config-prompt" class="input-style" rows="2" placeholder="Vd: làm tủ bếp dưới dài 2 mét, rộng 60 phân, cao 85 phân, có 3 khoang, dùng ván MDF An Cường chống ẩm."></textarea>
                                <button id="ai-config-btn" class="btn btn-secondary full-width" style="margin-top: 0.5rem;">
                                    <i class="fas fa-cogs"></i> Tạo Sản phẩm từ Mô tả
                                </button>
                            </div>
                            <hr class="form-divider">

                            <!-- Step 1: Product Info -->
                            <div class="form-section">
                                <h3 class="form-section-header"><span class="step-circle">1</span>Thông tin & Kích thước Sản phẩm</h3>
                                <div class="form-group">
                                    <label for="item-name" class="form-label">Tên sản phẩm / dự án</label>
                                    <input type="text" id="item-name" class="input-style" placeholder="Vd: Tủ bếp dưới chân sắt">
                                </div>
                                <div class="grid-3-col">
                                    <div><label for="item-length" class="form-label">Dài (mm)</label><input type="text" inputmode="decimal" id="item-length" class="input-style" placeholder="Vd: 2000"></div>
                                    <div><label for="item-width" class="form-label">Rộng (mm)</label><input type="text" inputmode="decimal" id="item-width" class="input-style" placeholder="Vd: 600"></div>
                                    <div><label for="item-height" class="form-label">Cao (mm)</label><input type="text" inputmode="decimal" id="item-height" class="input-style" placeholder="Vd: 850"></div>
                                </div>
                                <div class="form-group" style="margin-top: 1.25rem;">
                                    <label for="item-type" class="form-label">Loại sản phẩm</label>
                                    <select id="item-type" class="input-style">
                                        <option value="tu-bep-duoi">Tủ bếp dưới</option>
                                        <option value="tu-bep-tren">Tủ bếp trên</option>
                                        <option value="tu-ao">Tủ áo (Thùng, cánh, không hậu)</option>
                                        <option value="khac">Khác (Hộp 4 mặt, hở trước & sau)</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Step 2: Components & Materials -->
                            <div class="form-section">
                                <h3 class="form-section-header"><span class="step-circle">2</span>Cấu thành & Vật liệu Ván</h3>
                                <div class="form-group">
                                    <label class="form-label">Vật liệu ván</label>
                                    <div class="grid-2-col">
                                        <div>
                                            <label for="main-material-wood-input" class="sub-label">Ván chính (Thùng, cánh)</label>
                                            <div id="main-material-wood-combobox" class="combobox-container">
                                                <input type="text" id="main-material-wood-input" class="input-style combobox-input" placeholder="Tìm hoặc chọn loại ván...">
                                                <input type="hidden" class="combobox-value">
                                                <div class="combobox-options-wrapper">
                                                    <ul class="combobox-options"></ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label for="main-material-back-panel-input" class="sub-label">Ván hậu tủ (nếu khác ván chính)</label>
                                            <div id="main-material-back-panel-combobox" class="combobox-container">
                                                <input type="text" id="main-material-back-panel-input" class="input-style combobox-input" placeholder="Tìm hoặc chọn loại ván...">
                                                <input type="hidden" class="combobox-value">
                                                <div class="combobox-options-wrapper">
                                                    <ul class="combobox-options"></ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="component-header">
                                        <div>
                                            <label class="form-label">Danh sách Chi tiết Cấu thành</label>
                                            <p class="form-text" style="margin-top: -0.25rem; margin-bottom: 0.75rem;">AI sẽ dựa vào danh sách này để tính toán sơ đồ cắt. Bạn có thể chỉnh sửa hoặc thêm chi tiết tùy chỉnh.</p>
                                        </div>
                                    </div>
                                    <div class="table-wrapper">
                                        <table id="component-table" class="data-table component-table">
                                            <thead>
                                                <tr>
                                                    <th class="th-style th-name">Tên Chi tiết</th>
                                                    <th class="th-style">Dài</th>
                                                    <th class="th-style">Rộng</th>
                                                    <th class="th-style">SL</th>
                                                    <th class="th-style text-center th-delete">Xóa</th>
                                                </tr>
                                            </thead>
                                            <tbody id="components-table-body">
                                                <!-- JS will render component rows here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <button id="add-custom-component-btn" class="btn btn-secondary btn-sm" style="margin-top: 1rem;"><i class="fas fa-plus"></i> Thêm Chi tiết</button>
                                </div>
                            </div>
                            
                            <!-- Step 3: Accessories & Costs -->
                             <div class="form-section">
                                <h3 class="form-section-header"><span class="step-circle">3</span>Phụ kiện & Chi phí Hoàn thiện</h3>
                                <div class="form-group">
                                    <label for="edge-material-input" class="form-label">Vật liệu nẹp cạnh</label>
                                    <p class="form-text" style="margin-top: -0.25rem; margin-bottom: 0.75rem;">Chọn loại nẹp để AI tính toán chi phí dán cạnh tự động.</p>
                                    <div id="edge-material-combobox" class="combobox-container">
                                        <input type="text" id="edge-material-input" class="input-style combobox-input" placeholder="Tìm hoặc chọn loại nẹp...">
                                        <input type="hidden" class="combobox-value">
                                        <div class="combobox-options-wrapper">
                                            <ul class="combobox-options"></ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="material-accessories" class="form-label">Vật tư phụ & Phụ kiện khác</label>
                                    <p class="form-text" style="margin-top: -0.25rem; margin-bottom: 0.75rem;">Thêm các phụ kiện khác như bản lề, ray trượt tại đây. Chi phí nẹp cạnh được tính riêng ở trên.</p>
                                    <div class="accessory-adder">
                                        <div id="main-material-accessories-combobox" class="combobox-container">
                                            <input type="text" class="input-style combobox-input" placeholder="Tìm phụ kiện, gia công...">
                                            <input type="hidden" class="combobox-value">
                                            <div class="combobox-options-wrapper">
                                                <ul class="combobox-options"></ul>
                                            </div>
                                        </div>
                                        <input type="text" inputmode="decimal" id="accessory-quantity" class="input-style accessory-qty" placeholder="SL / mét" value="1" min="1">
                                        <button id="add-accessory-btn" class="btn btn-secondary accessory-add-btn"><i class="fas fa-plus"></i> Thêm</button>
                                    </div>
                                    <ul id="accessories-list" class="accessory-list"></ul>
                                </div>
                                <div class="grid-2-col" style="margin-top: 1.25rem;">
                                    <div class="form-group" style="margin-top: 0;">
                                        <label for="labor-cost" class="form-label">Chi phí nhân công (VND)</label>
                                        <input type="text" inputmode="decimal" id="labor-cost" class="input-style" value="0" placeholder="Vd: 500000">
                                    </div>
                                    <div class="form-group" style="margin-top: 0;">
                                        <label for="profit-margin" class="form-label">Lợi nhuận mong muốn (%)</label>
                                        <input type="text" inputmode="decimal" id="profit-margin" class="input-style" value="50">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="product-description" class="form-label">Mô tả hoặc ghi chú thêm về sản phẩm</label>
                                    <textarea id="product-description" class="input-style" rows="3" placeholder="Vd: Cánh tủ vát cạnh, không tay nắm. Có 2 ngăn kéo..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Hình ảnh tham khảo (Tùy chọn)</label>
                                    <div id="image-uploader" class="image-uploader">
                                        <input type="file" id="image-input" class="hidden" accept="image/*">
                                        <div id="image-upload-prompt">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                            <p>Nhấp hoặc kéo thả ảnh vào đây</p>
                                            <span>AI sẽ phân tích ảnh để đưa ra gợi ý chính xác hơn</span>
                                        </div>
                                        <div id="image-preview-container" class="hidden">
                                            <img id="image-preview" src="#" alt="Xem trước ảnh">
                                            <button id="remove-image-btn" class="remove-image-btn">&times;</button>
                                        </div>
                                    </div>
                                    <div id="image-analysis-container" class="hidden">
                                        <button id="analyze-image-btn" class="btn btn-secondary full-width">
                                            <i class="fas fa-ruler-combined"></i>
                                            <span>Phân tích Kích thước</span>
                                        </button>
                                        <button id="analyze-structure-btn" class="btn btn-secondary full-width">
                                            <i class="fas fa-sitemap"></i>
                                            <span>Phân tích Cấu trúc & Vị trí</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                           
                            <div class="main-actions-group">
                                <button id="save-item-btn" class="btn btn-secondary full-width" disabled>
                                    <i class="fas fa-save"></i> Lưu Dự án
                                </button>
                                <button id="analyze-btn" class="btn btn-primary full-width">
                                    <i class="fas fa-microchip"></i> Phân tích & Báo giá với AI
                                </button>
                            </div>

                            <!-- AI Full Analysis Result -->
                            <div id="ai-analysis-section" class="hidden">
                                <div id="ai-loading-placeholder" class="hidden">
                                    <div class="spinner"></div>
                                    <p>AI đang phân tích, vui lòng đợi trong giây lát...</p>
                                </div>
                                <div id="ai-results-content" class="hidden">
                                    <div id="price-summary-container" class="result-box">
                                        <div class="grid-3-col">
                                            <div class="price-card bg-indigo">
                                                <div class="price-label">Tổng Chi Phí</div>
                                                <div id="total-cost-value" class="price-value">0đ</div>
                                                <div class="price-sublabel">Gồm vật tư và nhân công</div>
                                            </div>
                                            <div class="price-card bg-yellow">
                                                <div class="price-label">Giá Bán Đề Xuất</div>
                                                <div id="suggested-price-value" class="price-value">0đ</div>
                                                <div class="price-sublabel">Đã gồm lợi nhuận mong muốn</div>
                                            </div>
                                            <div class="price-card bg-green">
                                                <div class="price-label">Lợi Nhuận Ước Tính</div>
                                                <div id="estimated-profit-value" class="price-value">0đ</div>
                                                <div class="price-sublabel">Sau khi trừ mọi chi phí</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="cost-breakdown-container" class="result-box"></div>
                                    
                                    <div id="cutting-layout-section" class="result-box">
                                        <h3 class="result-box-header"><i class="fas fa-th-large"></i> Sơ đồ Cắt ván Gợi ý từ AI</h3>
                                        <div id="cutting-layout-summary"></div>
                                        <div id="cutting-layout-container" class="cutting-layout-container">
                                            <!-- AI-generated layouts will be rendered here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="login-prompt-view">
                            <div class="icon-prompt"><i class="fas fa-lock"></i></div>
                            <h3>Tính năng dành cho thành viên</h3>
                            <p>Vui lòng đăng nhập để bắt đầu báo giá và lưu dự án của bạn.</p>
                        </div>
                    </div>
                    <div class="sidebar-card card">
                        <h2 class="card-header">Công cụ & Hướng dẫn</h2>
                        <div class="content-wrapper calculator-form-content">
                            <!-- 3D Viewer -->
                            <div id="viewer-3d-section">
                                <h4><i class="fas fa-cube"></i> Xem trước Sản phẩm 3D</h4>
                                <div id="viewer-3d-container" class="viewer-3d-container">
                                    <div class="scene-3d">
                                        <!-- JS will generate product components here -->
                                    </div>
                                    <div class="viewer-3d-instructions">Nhấn và kéo để xoay</div>
                                </div>
                            </div>
                            
                            <!-- Guide -->
                            <details class="guide-details" open>
                                <summary>
                                    <h4><i class="fas fa-question-circle"></i> Hướng dẫn sử dụng</h4>
                                </summary>
                                <ul>
                                    <li><strong>Khởi tạo Nhanh:</strong> Nhập mô tả sản phẩm (vd: "tủ áo 2m x 1m8, 4 cánh") và nhấn nút, AI sẽ tự động điền các thông số.</li>
                                    <li><strong>Điền thông tin:</strong> Hoàn thiện các thông tin chi tiết về kích thước, vật liệu, và phụ kiện cho sản phẩm của bạn.</li>
                                    <li><strong>Phân tích AI:</strong> Nhấn nút "Phân tích & Báo giá với AI" để nhận báo giá chi tiết, phân tích chi phí ẩn, gợi ý tối ưu và sơ đồ cắt ván.</li>
                                    <li><strong>Lưu & Tải lại:</strong> Đăng nhập và lưu các dự án quan trọng để xem lại hoặc chỉnh sửa sau này.</li>
                                </ul>
                           </details>
                        </div>
                         <div class="login-prompt-view">
                            <div class="icon-prompt"><i class="fas fa-info-circle"></i></div>
                            <h3>Chào mừng bạn!</h3>
                            <p>Đăng nhập để mở khóa tất cả tính năng.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Quick Calculator -->
            <div id="quick-calc-tab" class="tab-pane hidden">
                <div class="card">
                    <h2 class="card-header"><i class="fas fa-calculator" style="margin-right: 0.75rem;"></i>Tính Giá Nhanh</h2>
                    <div class="content-wrapper quick-calc-form-content">
                        <p class="settings-intro">Công cụ này giúp bạn ước tính nhanh chi phí dựa trên tổng số vật tư. Mọi thay đổi sẽ được tự động cập nhật vào kết quả bên dưới.</p>
                        
                        <!-- Section 1: Board Materials -->
                        <div class="form-group" style="margin-top: 0;">
                            <h3 class="result-box-header" style="margin-bottom: 1.5rem; font-size: 1.1rem;"><span class="step-circle">1</span>Vật liệu ván</h3>
                            <div class="grid-2-col" style="gap: 0.5rem 1.25rem;">
                                <div>
                                    <label for="qc-area" class="form-label">Diện tích ván loại 1 (m²)</label>
                                    <input type="text" inputmode="decimal" id="qc-area" class="input-style" placeholder="Vd: 4.5">
                                </div>
                                <div>
                                    <label for="qc-material-wood-input" class="form-label">Loại ván 1 (Chính)</label>
                                    <div id="qc-material-wood-combobox" class="combobox-container">
                                        <input type="text" id="qc-material-wood-input" class="input-style combobox-input" placeholder="Tìm hoặc chọn loại ván...">
                                        <input type="hidden" class="combobox-value">
                                        <div class="combobox-options-wrapper">
                                            <ul class="combobox-options"></ul>
                                        </div>
                                    </div>
                                    <small id="qc-sheet-count-display" class="form-text" style="margin-top: 0.5rem; text-align: right; color: var(--primary-color); font-weight: 500;"></small>
                                </div>
                            </div>
                            <div class="grid-2-col" style="gap: 0.5rem 1.25rem; margin-top: 1.25rem;">
                                <div>
                                    <label for="qc-area-2" class="form-label">Diện tích ván loại 2 (m²)</label>
                                    <input type="text" inputmode="decimal" id="qc-area-2" class="input-style" placeholder="Vd: 1.2">
                                </div>
                                <div>
                                    <label for="qc-material-wood-2-input" class="form-label">Loại ván 2 (Phụ)</label>
                                    <div id="qc-material-wood-2-combobox" class="combobox-container">
                                        <input type="text" id="qc-material-wood-2-input" class="input-style combobox-input" placeholder="Tìm hoặc chọn loại ván...">
                                        <input type="hidden" class="combobox-value">
                                        <div class="combobox-options-wrapper">
                                            <ul class="combobox-options"></ul>
                                        </div>
                                    </div>
                                    <small id="qc-sheet-count-display-2" class="form-text" style="margin-top: 0.5rem; text-align: right; color: var(--primary-color); font-weight: 500;"></small>
                                </div>
                            </div>
                        </div>

                        <!-- Section 2: Accessories, Edge, and Other Costs -->
                        <div class="form-group">
                             <h3 class="result-box-header" style="margin-bottom: 1.5rem; font-size: 1.1rem;"><span class="step-circle">2</span>Phụ kiện, Nẹp & Chi phí Phát sinh</h3>
                            <div class="accessory-adder qc-accessory-adder">
                                <div id="qc-material-accessories-combobox" class="combobox-container">
                                    <input type="text" class="input-style combobox-input" placeholder="Tìm phụ kiện hoặc nẹp...">
                                    <input type="hidden" class="combobox-value">
                                    <div class="combobox-options-wrapper">
                                        <ul class="combobox-options"></ul>
                                    </div>
                                </div>
                                <input type="text" inputmode="decimal" id="qc-accessory-quantity" class="input-style accessory-qty" placeholder="SL / mét" value="1" min="0">
                                <button id="qc-add-accessory-btn" class="btn btn-secondary accessory-add-btn"><i class="fas fa-plus"></i> Thêm</button>
                            </div>
                            <ul id="qc-accessories-list" class="accessory-list" style="margin-top: 1rem; margin-bottom: 1.25rem;"></ul>
                        </div>

                        <!-- Section 3: Pricing Setup -->
                        <div class="form-group">
                            <h3 class="result-box-header" style="margin-bottom: 1.5rem; font-size: 1.1rem;"><span class="step-circle">3</span>Thiết lập Giá bán</h3>
                            <div class="grid-2-col" style="gap: 0.5rem 1.25rem;">
                                 <div>
                                    <label for="qc-install-cost" class="form-label">Chi phí lắp đặt & phát sinh (VND)</label>
                                    <input type="text" inputmode="decimal" id="qc-install-cost" class="input-style" placeholder="Vd: 500000" value="0" min="0">
                                </div>
                                <div>
                                    <label for="qc-profit-margin" class="form-label">Lợi nhuận mong muốn (%)</label>
                                    <input type="text" inputmode="decimal" id="qc-profit-margin" class="input-style" value="50" min="0">
                                </div>
                            </div>
                        </div>

                        <!-- Section 4: Results -->
                        <div id="qc-results-container" style="margin-top: 2rem; border-top: 1px solid var(--border-color); padding-top: 2rem;">
                             <div class="grid-3-col">
                                <div class="price-card bg-indigo">
                                    <div class="price-label">Tổng Chi Phí</div>
                                    <div id="qc-total-cost-value" class="price-value">0đ</div>
                                    <div class="price-sublabel">Gồm tất cả vật tư và chi phí</div>
                                </div>
                                <div class="price-card bg-yellow">
                                    <div class="price-label">Giá Bán Đề Xuất</div>
                                    <div id="qc-suggested-price-value" class="price-value">0đ</div>
                                    <div class="price-sublabel">Đã gồm lợi nhuận mong muốn</div>
                                </div>
                                <div class="price-card bg-green">
                                    <div class="price-label">Lợi Nhuận Ước Tính</div>
                                    <div id="qc-estimated-profit-value" class="price-value">0đ</div>
                                    <div class="price-sublabel">Sau khi trừ mọi chi phí</div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="login-prompt-view">
                        <div class="icon-prompt"><i class="fas fa-calculator"></i></div>
                        <h3>Tính toán nhanh chóng</h3>
                        <p>Vui lòng đăng nhập để sử dụng công cụ tính giá nhanh dựa trên kho vật tư của bạn.</p>
                    </div>
                </div>
            </div>

            <!-- Tab 2: Quản lý Vật tư -->
            <div id="materials-tab" class="tab-pane hidden">
                <div class="card">
                    <h2 class="card-header">Quản lý Kho Vật tư</h2>
                    <div class="content-wrapper materials-form-content">
                        <form id="material-form" class="material-form">
                            <input type="hidden" id="material-id">
                            <div class="grid-2-col">
                                <div>
                                    <label for="material-name" class="form-label">Tên vật tư</label>
                                    <input type="text" id="material-name" class="input-style" placeholder="Vd: Ván MDF An Cường 17mm" required>
                                </div>
                                <div>
                                    <label for="material-type" class="form-label">Loại vật tư</label>
                                    <select id="material-type" class="input-style" required>
                                        <option value="Ván">Ván</option>
                                        <option value="Cạnh">Cạnh</option>
                                        <option value="Phụ kiện">Phụ kiện</option>
                                        <option value="Gia Công">Gia Công</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid-2-col">
                                <div>
                                    <label for="material-price" class="form-label">Đơn giá</label>
                                    <input type="text" inputmode="decimal" id="material-price" class="input-style" placeholder="Vd: 550000" required>
                                </div>
                                <div>
                                    <label for="material-unit" class="form-label">Đơn vị tính</label>
                                    <input type="text" id="material-unit" class="input-style" placeholder="Vd: tấm, mét, cái" required>
                                </div>
                            </div>
                            <div>
                                <label for="material-notes" class="form-label">Ghi chú</label>
                                <input type="text" id="material-notes" class="input-style" placeholder="Vd: Khổ 1220x2440, chống ẩm">
                            </div>
                            <div class="button-group" style="justify-content: flex-end;">
                                <button type="button" id="cancel-edit-button" class="btn btn-secondary hidden">Hủy</button>
                                <button type="submit" class="btn btn-primary"><i class="fas fa-plus mr-2"></i> Thêm Vật tư</button>
                            </div>
                        </form>
                        <div class="table-container">
                             <h3 class="table-header">Danh sách Vật tư</h3>
                             <div class="material-controls">
                                <div class="filter-wrapper">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="material-filter-input" class="input-style" placeholder="Lọc theo tên hoặc ghi chú...">
                                </div>
                                <select id="material-sort-select" class="input-style">
                                    <option value="name-asc">Sắp xếp: Tên A-Z</option>
                                    <option value="name-desc">Sắp xếp: Tên Z-A</option>
                                    <option value="price-asc">Sắp xếp: Giá thấp nhất</option>
                                    <option value="price-desc">Sắp xếp: Giá cao nhất</option>
                                    <option value="type">Sắp xếp: Loại vật tư</option>
                                </select>
                             </div>
                            <div class="table-wrapper">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th class="th-style">Tên</th>
                                            <th class="th-style">Loại</th>
                                            <th class="th-style">Đơn giá</th>
                                            <th class="th-style">Ghi chú</th>
                                            <th class="th-style text-center">Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="materials-table-body">
                                        <!-- JS will render here -->
                                    </tbody>
                                </table>
                            </div>
                             <div id="pagination-controls" class="pagination-controls hidden">
                                <span id="page-info"></span>
                                <div class="button-group" style="margin: 0; justify-content: flex-end;">
                                    <button id="prev-page-btn" data-direction="prev" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Trước</button>
                                    <button id="next-page-btn" data-direction="next" class="btn btn-secondary">Sau <i class="fas fa-arrow-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="login-prompt-view">
                        <div class="icon-prompt"><i class="fas fa-boxes"></i></div>
                        <h3>Quản lý vật tư của bạn</h3>
                        <p>Vui lòng đăng nhập để thêm, sửa, xóa các loại vật tư cho xưởng của mình.</p>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <h2 class="card-header">Quản lý Tên Chi tiết Cấu thành</h2>
                    <div class="content-wrapper component-names-content">
                        <form id="component-name-form" class="material-form">
                            <input type="hidden" id="component-name-id">
                            <div class="grid-2-col">
                                 <div>
                                    <label for="component-name-input" class="form-label">Tên chi tiết</label>
                                    <input type="text" id="component-name-input" class="input-style" placeholder="Vd: Hông Trái, Đáy, Nóc..." required>
                                </div>
                                <div>
                                     <label for="component-name-notes" class="form-label">Ghi chú</label>
                                     <input type="text" id="component-name-notes" class="input-style" placeholder="Tùy chọn">
                                </div>
                            </div>
                            <div class="button-group" style="justify-content: flex-end;">
                                <button type="button" id="cancel-component-name-edit-btn" class="btn btn-secondary hidden">Hủy</button>
                                <button type="submit" class="btn btn-primary"><i class="fas fa-plus mr-2"></i> Thêm Tên</button>
                            </div>
                        </form>
                        <div class="table-container">
                            <h3 class="table-header">Danh sách Tên Chi tiết</h3>
                            <div class="table-wrapper">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th class="th-style" style="width: 50%;">Tên</th>
                                            <th class="th-style">Ghi chú</th>
                                            <th class="th-style text-center">Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="component-names-table-body">
                                        <!-- JS will render here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="login-prompt-view">
                        <div class="icon-prompt"><i class="fas fa-list-alt"></i></div>
                        <h3>Tùy chỉnh danh sách chi tiết</h3>
                        <p>Vui lòng đăng nhập để quản lý danh sách tên chi tiết của bạn.</p>
                    </div>
                </div>
            </div>

            <!-- Tab 4: Dự án đã lưu -->
            <div id="saved-tab" class="tab-pane hidden">
                 <div class="card">
                    <h2 class="card-header">Các Dự án Đã Lưu</h2>
                    <div class="content-wrapper saved-items-content">
                        <div class="table-container">
                            <div class="table-wrapper">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th class="th-style">Tên dự án</th>
                                            <th class="th-style">Ngày tạo</th>
                                            <th class="th-style text-center">Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="saved-items-table-body">
                                        <!-- JS will render here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="login-prompt-view">
                        <div class="icon-prompt"><i class="fas fa-folder-open"></i></div>
                        <h3>Lưu trữ các dự án của bạn</h3>
                        <p>Vui lòng đăng nhập để xem lại các dự án đã tính toán.</p>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Modals -->
    <div id="login-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <h3 class="modal-title">Chào mừng bạn!</h3>
            <p style="text-align: center; color: var(--text-light); margin-bottom: 1.5rem;">Đăng nhập để lưu vật tư, dự án và sử dụng Trợ lý AI.</p>
            <div id="login-form-container">
                <div class="remember-me-container">
                    <input type="checkbox" id="remember-me-checkbox" checked>
                    <label for="remember-me-checkbox">Duy trì đăng nhập</label>
                </div>
                <button id="google-login-btn" class="google-btn full-width"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo" width="18" height="18"> Đăng nhập với Google</button>
                <p id="login-error" class="error-message"></p>
            </div>
        </div>
    </div>

    <div id="view-item-modal" class="modal-overlay hidden">
        <div class="modal-content modal-lg">
            <button class="modal-close-btn">&times;</button>
            <h3 id="view-item-title" class="modal-title">Chi tiết Dự án</h3>
            <div id="view-item-content" class="modal-body">
                <!-- JS will render content here -->
            </div>
        </div>
    </div>
    
    <div id="confirm-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 400px;">
            <h3 class="modal-title-sm" style="text-align: center;">Xác nhận</h3>
            <p id="confirm-message" class="confirm-text" style="text-align: center;">Bạn có chắc chắn muốn thực hiện hành động này?</p>
            <div class="confirm-actions">
                <button id="confirm-cancel-btn" class="btn btn-secondary">Hủy</button>
                <button id="confirm-ok-btn" class="btn btn-danger">Đồng ý</button>
            </div>
        </div>
    </div>
    
    <div id="toast-container"></div>
    
    <footer class="footer">
        <p>&copy; 2025 CostCraft AI.</p>
    </footer>

    <script src="script.js" type="module"></script>
</body>
</html>